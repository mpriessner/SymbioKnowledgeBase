# Story 1.2: Set Up Supabase Storage Buckets

## Metadata
- **Epic:** Epic 1 â€” File Upload & Storage System
- **Points:** 2
- **Priority:** High
- **Status:** ðŸ”² Not Started

## Description
Configure Supabase Storage buckets with proper organization and access controls for multi-tenant file storage.

## User Story
*As a system administrator, I want organized storage buckets so that files are securely stored with proper access controls.*

## Acceptance Criteria
- [ ] Create `files` bucket for original uploads
- [ ] Create `thumbnails` bucket for preview images
- [ ] Create `processed` bucket for extracted content
- [ ] Configure RLS policies for tenant isolation
- [ ] Files accessible only to tenant members
- [ ] Storage paths follow convention: `{tenant_id}/{page_id}/{file_id}.{ext}`

## Technical Details

### Bucket Structure
```
files/
â”œâ”€â”€ {tenant_id}/
â”‚   â”œâ”€â”€ {page_id}/
â”‚   â”‚   â””â”€â”€ {file_id}.{ext}
â”‚   â””â”€â”€ _uploads/
â”‚       â””â”€â”€ {file_id}.{ext}

thumbnails/
â”œâ”€â”€ {tenant_id}/
â”‚   â””â”€â”€ {file_id}_thumb.webp

processed/
â”œâ”€â”€ {tenant_id}/
â”‚   â””â”€â”€ {file_id}_extracted.json
```

### RLS Policy
```sql
CREATE POLICY "Tenant isolation for files"
ON storage.objects FOR ALL
USING (
  auth.uid() IN (
    SELECT user_id FROM users 
    WHERE tenant_id = (storage.foldername(name))[1]::uuid
  )
);
```

## Dependencies
- Depends on: None
- Blocks: 1.3, 1.4

## Files to Create/Modify
- `scripts/setup-storage-buckets.sql`
- `supabase/migrations/YYYYMMDD_storage_buckets.sql`

## Testing
- Manual: Verify buckets created in Supabase dashboard
- Integration: Upload/download test with RLS

## Complexity
**S (Small)** â€” Configuration only
