# Story 5.6: Build Version Diff Visualization Component

## Metadata
- **Epic:** Epic 5 â€” Living Documentation System
- **Points:** 5
- **Priority:** Medium
- **Status:** ðŸ”² Not Started

## Description
Create a React component that visually displays differences between document versions.

## User Story
*As a user, I want to see visual diffs between versions so that I can quickly understand what changed.*

## Acceptance Criteria
- [ ] React component for side-by-side diff view
- [ ] Highlights additions in green, deletions in red
- [ ] Inline diff mode option (unified view)
- [ ] Word-level diff granularity
- [ ] Handles block structure (not just text)
- [ ] Navigate to specific changes
- [ ] Copy button for individual changes
- [ ] Mobile-responsive layout

## Technical Details

### Component Interface
```typescript
// src/components/livingDocs/VersionDiff.tsx
interface VersionDiffProps {
  pageId: string;
  version1: number;
  version2: number;
  mode?: 'side-by-side' | 'inline';
}

interface DiffChange {
  type: 'added' | 'removed' | 'unchanged';
  content: string;
  lineNumber?: number;
}
```

### Diff Algorithm
```typescript
// src/lib/livingDocs/diffEngine.ts
import { diffWords, diffLines } from 'diff';

export function computeDiff(oldText: string, newText: string): DiffChange[] {
  const changes = diffWords(oldText, newText);
  
  return changes.map(change => ({
    type: change.added ? 'added' : change.removed ? 'removed' : 'unchanged',
    content: change.value
  }));
}

// For TipTap JSON content
export function computeBlockDiff(
  oldContent: TipTapContent,
  newContent: TipTapContent
): BlockDiffChange[] {
  // Compare block-by-block
  // Identify added/removed/modified blocks
  // For modified blocks, compute text diff
}
```

### UI Components
```typescript
// Side-by-side view
<div className="grid grid-cols-2 gap-4">
  <div className="version-old">
    {renderVersion(version1, diff, 'old')}
  </div>
  <div className="version-new">
    {renderVersion(version2, diff, 'new')}
  </div>
</div>

// Inline view
<div className="version-inline">
  {diff.map((change, i) => (
    <span
      key={i}
      className={cn(
        change.type === 'added' && 'bg-green-100 text-green-800',
        change.type === 'removed' && 'bg-red-100 text-red-800 line-through'
      )}
    >
      {change.content}
    </span>
  ))}
</div>
```

## Dependencies
- Depends on: 5.1, 5.4
- Blocks: None

## Files to Create/Modify
- `src/components/livingDocs/VersionDiff.tsx`
- `src/components/livingDocs/DiffLine.tsx`
- `src/lib/livingDocs/diffEngine.ts`
- `src/components/livingDocs/VersionHistoryPanel.tsx`

## Testing
- Unit: Diff algorithm accuracy
- Component: Rendering modes
- Visual: Styling accuracy

## Complexity
**M (Medium)** â€” Algorithm + UI implementation
