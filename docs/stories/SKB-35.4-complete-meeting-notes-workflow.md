# SKB-35.4: Complete Meeting Notes Workflow

**Story ID:** SKB-35.4
**Epic:** [EPIC-35 — AI Meeting Notes Full Workflow](EPIC-35-AI-MEETING-NOTES-FULL-WORKFLOW.md)
**Points:** 8
**Priority:** High
**Status:** Draft

---

## Summary

Ensure the full meeting notes workflow completes end-to-end: Record audio, transcribe it, let the user edit the raw transcript, send it to the LLM for structuring, and produce a final page that includes both the structured notes AND the raw transcript. Currently the raw transcript is shown during the editing step but is not included in the final output.

---

## Current Workflow Analysis

**Working steps:**
1. `VoiceRecorder.tsx` — Records audio via MediaRecorder, produces a Blob
2. `MeetingNotesGenerator.tsx` (line 37-70) — Sends audio blob to `/api/ai/transcribe`, receives text
3. `TranscriptPreview.tsx` — Shows raw transcript in an editable textarea
4. `MeetingNotesGenerator.tsx` (line 72-78) — Sends transcript to `/api/ai/generate-page` with `meeting-notes` template
5. `StreamingPreview.tsx` — Shows live generation output
6. Completion buttons — "Start over" or "Use these notes"

**Gaps:**
- The final generated page only contains the LLM-structured notes (title, attendees, agenda, discussion, action items, decisions, takeaways)
- The raw transcript is NOT included in the final page — once the user clicks "Use these notes", the transcript is lost
- `meeting-notes-prompt.ts` doesn't instruct the LLM to include the raw transcript section
- There's no "Raw Transcript" section in the generated output template
- The "Use these notes" button creates/updates the page with only the streamed content — no transcript appended

---

## Acceptance Criteria

- After the LLM finishes structuring the notes, the final page includes:
  1. **Structured notes** (title, attendees, agenda, discussion, action items, decisions, takeaways) — as generated by the LLM
  2. **Raw Transcript** section at the bottom — the original transcript text, preserved verbatim
- The raw transcript section is collapsible (toggle) so it doesn't clutter the view
- The user can still edit the transcript before generation (existing TranscriptPreview behavior)
- The "Use these notes" button saves both structured notes and raw transcript to the page
- If the user clicks "Start over", both structured notes and transcript are cleared
- Duration and date metadata appear in the page header

---

## Implementation Approach

### 1. Update meeting-notes-prompt.ts

Add instruction to include the raw transcript:

```typescript
// At the end of the prompt template, add:
`

## Raw Transcript

<details>
<summary>Click to expand original transcript</summary>

${transcript}

</details>
`
```

Or alternatively, append the raw transcript section after the LLM generation completes (don't ask the LLM to copy the transcript — just append it mechanically).

### 2. Update MeetingNotesGenerator.tsx

After the LLM streaming completes:
- Append a "## Raw Transcript" section with the original transcript text to the page content
- This ensures the transcript is preserved exactly as-is (not modified by the LLM)

### 3. Verify page save

Ensure the "Use these notes" button saves the complete content (structured notes + raw transcript) to the page via the page update API.

---

## Files to Modify

| File | Change |
|------|--------|
| `src/components/ai/MeetingNotesGenerator.tsx` | Append raw transcript section to final content before saving |
| `src/lib/ai/meeting-notes-prompt.ts` | Optionally add instruction about raw transcript placement |
| `src/components/ai/StreamingPreview.tsx` | Show raw transcript section below the streamed content |

---

## Do NOT Break

- Recording flow (VoiceRecorder)
- Transcription API call
- Transcript editing (TranscriptPreview)
- LLM streaming generation
- "Start over" functionality
- Page creation/update API
- Existing AI chat functionality

---

## Test Coverage

**Unit Tests:**
- Final page content includes "## Raw Transcript" section
- Transcript text is preserved verbatim (not modified by LLM)
- "Start over" clears both structured notes and transcript

**Integration Tests:**
- Full flow: record → transcribe → edit → generate → page contains both sections
- Raw transcript section is at the bottom of the page

**E2E Tests:**
1. Record a meeting (or use a test audio file)
2. Stop recording → transcript appears
3. Optionally edit transcript
4. Click "Generate Notes" → LLM structures the notes
5. Verify raw transcript section appears below the structured notes
6. Click "Use these notes" → page is saved
7. Navigate to the page → both structured notes and raw transcript visible
8. Raw transcript section is collapsible

---

## Verification Steps

1. Open AI Meeting Notes
2. Record audio and stop
3. Edit the transcript if desired
4. Click Generate Notes
5. Wait for LLM to finish
6. Verify: Below the structured notes, a "Raw Transcript" section appears
7. Click "Use these notes"
8. Open the saved page
9. Verify: Both structured notes and raw transcript are present
10. The raw transcript matches what was in the transcript editor

---

**Last Updated:** 2026-02-27
